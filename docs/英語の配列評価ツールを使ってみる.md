# 英語の配列評価ツールを使ってみる

## Genkey

Semimak配列を作るときに使われたツール。

### インストール

GitHubのリリースページからダウンロードする。

### 機能

- 詳細な出力
- 生成？
- 重み付けのカスタマイズ
- 個々の配列の改善
- ヒートマップ出力
- インタラクティブな分析
- etc

ということで、一つずつ見ていこう。

```
- ヘルプ：genkey だけで実行するとコマンド一覧が出る。
- ランキング表示：genkey rank
- レイアウト詳細分析：genkey analyze colemak_dh（layouts/ にある名前を指定）
- ヒートマップ出力：genkey heatmap colemak_dh（config.toml の Output.Heatmap に指定されたパスに PNG）
- インタラクティブ分析：genkey interactive colemak_dh
- 最適化（既存レイアウト改善）：genkey improve colemak_dh
- 自動生成：genkey generate（Generation.GeneratedLayoutChars/InitialPopulation など設定を利用）
- コーパス読み込み：genkey load /path/to/corpus.txt
→ Corpus で指定した名前の JSON を Paths.Corpora 直下に生成し、以降の分析に使われる。
- N グラム頻度：genkey ngram th / genkey sfbs colemak_dh 15 / genkey dsfbs colemak_dh 10 など。
```

```bash
genkey load hello.txt
```

### コーパスの作成

`Hello, world!`と書いたテキストを読ませた。コーパスの形式にしてくれるみたい。`corpora/hello.json`が作成された。これを使うには`config.toml`を書き換える。

```txt
{
  "letters": { ",": 1, "d": 1, "e": 1, "h": 1, "l": 3, "o": 2, "r": 1, "w": 1 },
  "bigrams": {
    "el": 1,
    "he": 1,
    "ld": 1,
    "ll": 1,
    "lo": 1,
    "o,": 1,
    "or": 1,
    "rl": 1,
    "wo": 1
  },
  "trigrams": {
    "ell": 1,
    "hel": 1,
    "llo": 1,
    "lo,": 1,
    "orl": 1,
    "rld": 1,
    "wor": 1
  },
  "toptrigrams": [
    { "Ngram": "rld", "Count": 1 },
    { "Ngram": "hel", "Count": 1 },
    { "Ngram": "ell", "Count": 1 },
    { "Ngram": "llo", "Count": 1 },
    { "Ngram": "lo,", "Count": 1 },
    { "Ngram": "wor", "Count": 1 },
    { "Ngram": "orl", "Count": 1 }
  ],
  "skipgrams": {
    "e,": 0.25,
    "el": 1,
    "eo": 0.5,
    "h,": 0.125,
    "hl": 1.5,
    "ho": 0.25,
    "l,": 1.5,
    "lo": 1,
    "od": 0.5,
    "ol": 1,
    "rd": 1,
    "wd": 0.25,
    "wl": 0.5,
    "wr": 1
  },
  "TotalBigrams": 9,
  "Total": 14
}
```

```bash
genkey rank
```

配列がスコア順にランク付けされる。配列は`layouts`ディレクトリに入っている。

```bash
genkey generate
```

コーパスを元に、スコアを最小化するような配列を作成してくれる。

配列は一番上に表示されるやつが一番スコアがいいやつかな？それコピぺしてlayouts/に突っ込んでみました。

```bash
genkey improve [layout]
```

指定した配列を改善してくれる。動かさないものを決めるには`__generate`ファイルで設定する。`X`が移動不可、`*`は移動可。

```bash
genkey interactive qwerty
```

インタラクティブに配列を変更して結果を確認できる強力なツール。めちゃくちゃいいですね。

```bash
s key1 key2 # key1とkey2のスワップ
cs key1 key2 # key1がある列とkey2がある列のスワップ
cs col1 col2 # col1とcol2のスワップ
g # どのキーを入れ替えるべきかのアドバイス
save # 保存
q # 終了
```

## Oxeylyzer

### インストール

Rust nightlyが必要。

```bash
rustup install nightly
rustup default nightly
```

プロジェクトをクローンしてビルドする。

```bash
git clone https://github.com/O-X-E-Y/oxeylyzer.git
cd oxeylyzer
cargo run --release
# 任意 oxeylyzerとしてインストール
cargo install --path ./
```

### 使い方

- rank レイアウト一覧をスコア順に表示
- generate <count> レイアウトをcount個作って、TOP10を表示
- improve <layout> pins設定を使ってレイアウトを改良
- analyze <名前|番号> レイアウトを詳細表示
- compare a b 2つのレイアウトを比較
- save <番号> [-n 名前] 生成結果を保存
- sfbs <layout> 同指連続の上位を表示
- language 利用可能な言語一覧
- load コーパス生成
- include <lang> 他言語のレイアウトを取り込む
- ngram <パターン> N-gram情報
- reload 設定を再読み込み
- quit 終了

### 使ってみる

REPLになっているみたい。確かにその方が続けてコマンド入力できるから使いやすい。

```text
> rank
-8.640:   xpert
-1.781:   stronk
-1.671:   sturdy_thumbn
-1.640:   ieon1
-1.499:   dusk
-1.360:   stronk-thumbn
```

言語は`shai`になっている。`static/layouts/{language}`の中にレイアウト一覧があって、それぞれのレイアウトのスコアが計算される。

`shai`はColemakの作者のShai Colemakが公開している英語コーパスのこと。コーパスには韓国語もある。できるの？（びっくり）

```text
> generate 500
generating 500 layouts...
optimizing 500 variants took: 2 seconds
#0, score: -1.66092
, u a c g  q b d l v
i e o m y  f n t r s
. ; ' w z  p h k j x
#1, score: -1.68950
y o u m .  v w d l q
i a e h f  g s t r n
j ; ' , z  b c k x p
#2, score: -1.69246
j u a h x  w g l d v
i e o n .  f y r t s
, ; ' b q  c p m k z
#3, score: -1.70223
j u a f b  x w h v z
e i o n ,  c d r s t
; . ' p q  m g l y k
#4, score: -1.72465
c m d h p  ; ' u l y
g s t n f  . o e r i
w v k b q  , a z x j
#5, score: -1.73106
v f h c m  q x u l j
t s n d y  . a i r e
k b p g w  ' o , z ;
#6, score: -1.73601
j u a f x  q k l p w
i e o s ,  m t r n g
. ; ' y z  v d h b c
#7, score: -1.74955
c y m p f  x a u l z
g s t h n  . o i r e
w v d b k  q ' , j ;
#8, score: -1.75088
j u a f b  q k r l c
e i o h y  m t n s g
; , ' p .  v d x z w
#9, score: -1.75368
. u o c g  b f d l x
a i e m y  p n t r s
; , q w '  v h k j z
```

improveもgenerateと似たような感じ。レイアウトを指定して、改善する。

```text
> analyze dusk
dusk
x f d p q  j ' o u .
n s t c y  m h a e i
b v k g w  z l ~ / ,
Sfb:  0.527%
Dsfb: 4.887%
Finger Speed: 17.249
    [1.646, 1.455, 2.012, 2.646, 2.290, 1.840, 2.655, 2.705]
Scissors: 0.309%
Lsbs: 2.186%
Pinky Ring Bigrams: 1.764%

Inrolls: 19.966%
Outrolls: 19.819%
Total Rolls: 39.785%
Onehands: 1.249%

Alternates: 20.987%
Alternates (sfs): 5.167%
Total Alternates: 26.154%

Redirects: 2.653%
Redirects Sfs: 1.483%
Bad Redirects: 0.278%
Bad Redirects Sfs: 0.111%
Total Redirects: 4.525%

Bad Sfbs: 0.332%
Sft: 0.010%

Score: -1.499
```

saveは、生成したレイアウトを名前をつけて保存する。

```
> save 0 generated
saved generated
j u a f x  g w d l q
e i o m b  y s t r n
; . ' h ,  v c k z p
```

`sfbs`はレイアウトの同指連続になる2-gramを表示する。

```text
> sfbs dusk
top 10 sfbs for dusk:
ue: 0.130%
oa: 0.075%
cy: 0.033%
lm: 0.024%
gy: 0.023%
'm: 0.021%
yp: 0.021%
eu: 0.019%
'l: 0.017%
hl: 0.016%

```

`language`は分析に使う言語を切り替える。言語というかコーパスと考えた方がよさそう。

```text
> language english
"english"
Set language to english. Sfr: 2.74%
```

`include`は他の言語のレイアウトを一時的に取り込む。CLIを抜けると元に戻る。

以下は`shai`に`english`を取り込んだ。

```text
> include english
```

`load`

`ngram`は1~3-gramの情報を表示する。2gramの場合はskipgramも表示される。

```text
> ngram a
a: 7.929%

> ngram the
the: 2.702%

> ngram hello
Invalid ngram! It must be 1, 2 or 3 chars long.

> ngram for
for: 0.583%

> ngram hi
hi + ih: 0.679%,
  hi: 0.677%
  ih: 0.001%
hi + ih (skipgram): 0.733%,
  hi: 0.169%
  ih: 0.564%
```

（ここから）コーパスがどこに配置されているかはまだわかっていないので、見つける。

## Genkeyの指標やスコアの計算方法を調べる

## Oxeylyzerの指標やスコアの計算方法を調べる

## メモ

[入力パラメータを与えて、最適なレイアウトを計算してくれるプログラムとか、ウェブサイトってある？ : r/KeyboardLayouts](https://www.reddit.com/r/KeyboardLayouts/comments/13uekk3/is_there_a_program_or_website_to_calculate_an/?tl=ja)

2022年のスレッド。GenkeyとOxeylyzerがおすすめされている。あとOxeylyzerのWeb版のリンクもある。
