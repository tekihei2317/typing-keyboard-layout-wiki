# 分析用ツールの開発について

配列を作った際に、その配列を素早く評価するためのコマンドラインツールを作りたい。ツール名はclaとする（Kana Layout Analyzer = klaだとKeyboard Layout Analyzerと被るので）。

具体的には、配列の定義を何らかのデータ形式で作成し、ワードファイルも指定して、打鍵効率等のデータを計算したい。

## 配列の定義について

順次打鍵を想定しているので、配列のデータはGoogle日本語入力のローマ字テーブルで定義できる。

TypeScriptファイルで定義した方がいいかと思ったが、そこまで利便性は変わらないのでtsvファイルで定義して読み込むことにしよう。

## ワードファイルについて

現在はWeather Typingのxmlファイルを使用している。ただXMLは冗長なので、Weather Typingの簡易フォーマットを使うことにしたい。

具体的には以下のように、漢字1ひらがな1漢字2ひらがな2...のように、ワードの漢字かな混じり文と読み仮名を交互に記載していく。

```text
まだ親のすねをかじっている
まだおやのすねをかじっている
骨の折れる仕事だ
ほねのおれるしごとだ
...
```

Weather Typingのワードは前半パートと後半パートの2つに分かれており、それぞれのフレーズのランダムな組み合わせがワードとして出題される。前半パートと後半パートの区切りは空行を開ける決まりがある。


## 計算するデータについて

- 打鍵効率（1かなの入力に必要な打鍵数）
- 指負荷（列の使用率）
- 行の使用率（上段、中段、下段など）

これらのデータをJSON等の構造化されたデータで出力したい。最初は打鍵効率のみでよい。

## 打鍵効率の計算方法について

各配列について、ワードを受け取って打鍵数を計算する関数を作成する。例えば、

```ts
function calculateStrokesRoman(word: Word): number {
  // ローマ字の打鍵数を計算するロジック
  // 例えば、ワードが"りんご"のときはringoなので、5を返す
}

const layouts = {
  roman: calculateStrokesRoman,
  tsuki: calculateStrokesTsuki,
}
```

この関数を使って、例えば次のようにコマンドを実行する。

```bash
cla --layout roman --word ./words/word4jp.txt
{
  "efficiency": {
    "totalKanas": 3000,
    "totalStrokes": 5250,
    "efficiency": 1.75,
  }
}
```
